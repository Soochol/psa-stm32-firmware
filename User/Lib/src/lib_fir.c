#include "lib_fir.h"

static float FIR_IMPULSE_RESPONSE[FIR_FLITER_LEN] = {
		0.000003228672129466  ,
		0.000006435447499100  ,
		0.000010099568364490  ,
		0.000014169540508546  ,
		0.000017868450502174  ,
		0.000019472807607624  ,
		0.000016064761631562  ,
		0.000003263670400185  ,
		-0.000025049529853776 ,
		-0.000076993734899770 ,
		-0.000162906063247341 ,
		-0.000295482754385156 ,
		-0.000489805210003197 ,
		-0.000763214570548336 ,
		-0.001135003169147303 ,
		-0.001625900474888097 ,
		-0.002257344386989664 ,
		-0.003050545160223284 ,
		-0.004025367601170436 ,
		-0.006226165623448647 ,
		-0.007494418110678065 ,
		-0.008977628786915662 ,
		-0.010524104005663530 ,
		-0.011936939417368288 ,
		-0.012993725857191506 ,
		-0.013470957315154887 ,
		-0.013170518399434493 ,
		-0.011945270546659567 ,
		-0.009720736702616783 ,
		-0.006510214840111807 ,
		-0.002421301681552905 ,
		0.002347289031303558  ,
		0.007518673895179201  ,
		0.012759484236643902  ,
		0.017708262018813321  ,
		0.022007752980817585  ,
		0.025337795786575378  ,
		0.027445380579295492  ,
		0.028168704989754358  ,
		0.027445380579295992  ,
		0.025337795786575475  ,
		0.022007752980817336  ,
		0.017708262018813335  ,
		0.012759484236644091  ,
		0.007518673895179142  ,
		0.002347289031303289  ,
		-0.002421301681552922 ,
		-0.006510214840111671 ,
		-0.009720736702616761 ,
		-0.011945270546659616 ,
		-0.013170518399434502 ,
		-0.013470957315154897 ,
		-0.012993725857191513 ,
		-0.011936939417368300 ,
		-0.010524104005663552 ,
		-0.008977628786915690 ,
		-0.007494418110678074 ,
		-0.006226165623448654 ,
		-0.004025367601170447 ,
		-0.003050545160223296 ,
		-0.002257344386989665 ,
		-0.001625900474888097 ,
		-0.001135003169147315 ,
		-0.000763214570548350 ,
		-0.000489805210003199 ,
		-0.000295482754385158 ,
		-0.000162906063247343 ,
		-0.000076993734899774 ,
		-0.000025049529853774 ,
		0.000003263670400191  ,
		0.000016064761631560  ,
		0.000019472807607617  ,
		0.000017868450502177  ,
		0.000014169540508548  ,
		0.000010099568364488  ,
		0.000006435447499093  ,
		0.000003228672129469  ,
};

void _v_FIR_Init(_x_FIR_t* fir){
	for(uint8_t n=0; n < FIR_FLITER_LEN; n++){
		fir->buf[n] = 0.0f;
	}

	fir->out = 0.0f;
}


float _f_FIR_Upd(_x_FIR_t* fir, float in){
	fir->buf[fir->bufindex] = in;

	fir->bufindex++;
	if(fir->bufindex == FIR_FLITER_LEN){
		fir->bufindex = 0;
	}

	fir->out = 0.0f;
	uint8_t sumIndex = fir->bufindex;

	for(uint8_t n=0; n < FIR_FLITER_LEN; n++){
		if(sumIndex > 0){
			sumIndex--;
		}
		else{
			sumIndex = FIR_FLITER_LEN - 1;
		}
		fir->out += FIR_IMPULSE_RESPONSE[n] * fir->buf[sumIndex];

	}

	return fir->out;
}





